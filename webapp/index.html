<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Crypto Poker WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial,sans-serif; background:#0f0f0f; color:#fff; margin:0; }
    header { padding:16px; display:flex; justify-content:space-between; background:#1f1f1f; }
    .user { display:flex; align-items:center; }
    .user .avatar { width:40px; height:40px; background:#333; border-radius:50%; margin-right:12px; }
    .user .name { font-weight:bold; }
    .balance { display:flex; align-items:center; }
    .actions, .tabs { display:flex; padding:16px; background:#1a1a1a; }
    .actions button, .tabs .tab { flex:1; margin:0 8px; padding:10px; border:none; border-radius:4px; cursor:pointer; }
    .actions button { background:#ffd700; color:#000; }
    .tabs .tab { background:transparent; color:#888; }
    .tabs .tab.active { color:#fff; border-bottom:2px solid #ffd700; }
    #info { padding:16px; }
  </style>
</head>
<body>
  <header>
    <div class="user">
      <div class="avatar"></div>
      <div>
        <div class="name" id="username">‚Äî</div>
        <div class="balance">üí∞ <span id="current-balance">0.00 USDT</span></div>
      </div>
    </div>
  </header>
  <div class="actions">
    <button id="deposit">–î–µ–ø–æ–∑–∏—Ç</button>
    <button id="withdraw">–í—ã–≤–µ—Å—Ç–∏</button>
    <button id="history">–ò—Å—Ç–æ—Ä–∏—è</button>
  </div>
  <div class="tabs">
    <div class="tab active" data-tab="cash">–ö—ç—à</div>
    <div class="tab" data-tab="tournaments">–¢—É—Ä–Ω–∏—Ä—ã</div>
    <div class="tab" data-tab="more">–ï—â—ë</div>
  </div>
  <div id="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const webapp = Telegram.WebApp;
      webapp.ready();

      // –ü–æ–ª—É—á–∞–µ–º userId –∏ username –∏–∑ Telegram
      const user = webapp.initDataUnsafe.user || {};
      const userId = user.id;
      document.getElementById('username').textContent = user.username || user.first_name || '‚Äî';

      // –•–µ–ª–ø–µ—Ä –¥–ª—è API-–∑–∞–ø—Ä–æ—Å–æ–≤
      async function callApi(path) {
        const res = await fetch(`${path}?user_id=${userId}`);
        if (!res.ok) throw new Error(res.status);
        return res.json();
      }

      // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
      async function updateBalance() {
        try {
          const { balance } = await callApi('/api/balance');
          document.getElementById('current-balance').textContent = `${balance.toFixed(2)} USDT`;
        } catch (e) {
          console.error(e);
        }
      }
      updateBalance();

      // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
      document.getElementById('deposit').onclick = async () => {
        try {
          const { address } = await callApi('/api/deposit');
          document.getElementById('info').textContent =
            `üì• –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–æ–Ω–µ—Ç—ã –Ω–∞ –∞–¥—Ä–µ—Å:\n${address}`;
        } catch (e) {
          document.getElementById('info').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ';
        }
      };
      document.getElementById('withdraw').onclick = async () => {
        try {
          const { instructions } = await callApi('/api/withdraw');
          document.getElementById('info').textContent = `üì§ ${instructions}`;
        } catch (e) {
          document.getElementById('info').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ';
        }
      };
      document.getElementById('history').onclick = async () => {
        try {
          const { history } = await callApi('/api/history');
          document.getElementById('info').textContent =
            history.length
              ? history.join('\n')
              : 'üìú –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞';
        } catch (e) {
          document.getElementById('info').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏';
        }
      };

      // –í–∫–ª–∞–¥–∫–∏ UI (–∑–∞–≥–ª—É—à–∫–∞)
      document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById('info').textContent = `–í—ã –≤—ã–±—Ä–∞–ª–∏: ${tab.dataset.tab}`;
        };
      });
    });
  </script>
</body>
</html>
