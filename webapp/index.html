<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto Poker WebApp</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0f0f0f;color:#fff}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#1f1f1f}
    .user{display:flex;align-items:center}
    .avatar{width:40px;height:40px;border-radius:50%;background:#333;margin-right:10px}
    .info{display:flex;align-items:center}
    .balance{margin-left:8px}
    .actions{display:flex;padding:12px;background:#1a1a1a}
    .actions button{flex:1;margin:0 6px;padding:10px;background:#ffd700;border:none;border-radius:4px;color:#000;cursor:pointer}
    .tabs{display:flex;padding:8px 12px;background:#1a1a1a}
    .tab{flex:1;text-align:center;padding:8px;color:#888;cursor:pointer}
    .tab.active{color:#fff;border-bottom:2px solid #ffd700}
    #level-select{margin-left:12px;padding:6px;background:#333;border:none;color:#fff;border-radius:4px}
    #info{padding:16px;white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <div class="user">
      <div class="avatar"></div>
      <div class="info">
        <div id="username">‚Äî</div>
        <div class="balance">üí∞ <span id="current-balance">0.00 USDT</span></div>
      </div>
    </div>
    <select id="level-select">
      <option>Low</option>
      <option>Mid</option>
      <option>VIP</option>
    </select>
  </header>
  <div class="actions">
    <button id="deposit">–î–µ–ø–æ–∑–∏—Ç</button>
    <button id="withdraw">–í—ã–≤–µ—Å—Ç–∏</button>
    <button id="history">–ò—Å—Ç–æ—Ä–∏—è</button>
  </div>
  <div class="tabs">
    <div class="tab active" data-tab="cash">–ö—ç—à</div>
    <div class="tab" data-tab="tournaments">–¢—É—Ä–Ω–∏—Ä—ã</div>
    <div class="tab" data-tab="more">–ï—â—ë</div>
  </div>
  <div id="info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const info = document.getElementById('info');
    const params = new URLSearchParams(window.location.search);
    const userId = params.get('user_id');
    document.getElementById('username').textContent = params.get('username') || '‚Äî';

    // –•–µ–ª–ø–µ—Ä API
    async function api(path) {
      const res = await fetch(`${path}?user_id=${userId}&mode=cash&level=${encodeURIComponent(document.getElementById('level-select').value)}`);
      return res.json();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ cash-—Å—Ç–æ–ª–æ–≤
    document.querySelector('.tab[data-tab="cash"]').onclick = async () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.tab[data-tab="cash"]').classList.add('active');
      info.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–æ–≤...';
      try {
        const tables = await api('/api/tables');
        info.innerHTML = '';
        tables.forEach(t => {
          const div = document.createElement('div');
          div.innerHTML = `
            <strong>–°—Ç–æ–ª ${t.id}</strong><br/>
            ${t.small_blind}/${t.big_blind} ‚Äî –±–∞–π-–∏–Ω ${t.buy_in} ‚Äî ${t.players}<br/>
            <button onclick="window.location.href='game.html?user_id=${userId}&table_id=${t.id}'">–ò–≥—Ä–∞—Ç—å</button>
          `;
          info.append(div);
        });
      } catch {
        info.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–æ–ª–æ–≤';
      }
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏ –ø—Ä–æ—á–µ–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

    // Actions: –¥–µ–ø–æ–∑–∏—Ç, –≤—ã–≤–æ–¥, –∏—Å—Ç–æ—Ä–∏—è
    document.getElementById('deposit').onclick = async () => {
      const deposit = await fetch(`/api/deposit?user_id=${userId}`).then(r=>r.json());
      info.textContent = `üì• –ê–¥—Ä–µ—Å: ${deposit.address}`;
    };
    document.getElementById('withdraw').onclick = async () => {
      const w = await fetch(`/api/withdraw?user_id=${userId}`).then(r=>r.json());
      info.textContent = `üì§ ${w.instructions}`;
    };
    document.getElementById('history').onclick = async () => {
      const h = await fetch(`/api/history?user_id=${userId}`).then(r=>r.json());
      info.textContent = h.history.length ? h.history.join('\n') : 'üìú –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞';
    };

    // –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞–±
    document.querySelector('.tab[data-tab="cash"]').click();
  });
  </script>
</body>
</html>
